@model DAL_Data_Access_Layer_.CustomeModel.PatientDashboard;

@{
    ViewData["Title"] = "Submit Request Page";
}

@{
    string[] Enum = { "","Unassigned", "Accepted", "Cancelled", "MDEnRoute" , "MDOnSite" , "Conclude" ,
                 "CancelledByPatient" , "Closed" , "Unpaid" , "Clear"   };
}

<partial name ="_Notification" />

<style>

    .card-body{
        background-color: #d9ecf4!important;
    }

    .chatTime {
        position: absolute;
        right: 9px;
        bottom: -19px;
    }

    .chatTimeTwo {
        position: absolute;
        left: 9px;
        bottom: -19px;
    }

</style>

<h4 class="medical-text mt-5">Medical History</h4>
<div class="createreq">
    <button type="button" class="btn ms-auto createnewreq" data-bs-toggle="modal"
            data-bs-target="#newRequestModal">
        <Span class=" d-none d-sm-block dark-mode1">
            Create New
            Request
        </Span><i class="fa-solid fa-plus bi bi-plus-lg d-block d-sm-none"></i>
    </button>
    <!-- Modal -->
    <div class="modal fade " id="newRequestModal" tabindex="-1" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background:skyblue;">
                    <h5 class="modal-title" id="exampleModalLabel">Create New Request</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body ">
                    Here , i want to Create new Request for..
                    <div class="mt-3">
                        <button type="button" class="btn" id="firstBtn" onclick="meId(0)"><span>Me</span></button>
                        <button type="button" class="btn" id="secondBtn" onclick="meId(1)"><span>Some one else</span></button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn " onclick="redirectPage()" style="background:skyblue;">Continue</button>
                    <button type="button" class="btn "
                            data-bs-dismiss="modal">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
 <div class="d-none d-sm-block">

    <table class="table data_table " style="background:white;">

        <thead class="table-active">
            <tr >
                <th scope="col" >Created Date</th>
                <th scope="col">Current Status</th>
                <th scope="col">Document</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.data)

            {
                <tr >
                    <td>
                        @item.created_date.Day
                        @item.created_date.ToString("MMM")
                        @item.created_date.Year
                    </td>
                    <td>@Enum[Convert.ToInt32(item.status)]</td>
                    <td>
                            <button type="button" class="btn documents " style="width:9em;float:left;"  onclick="location.href='@Url.Action("viewDetail","patientDashboard",new {
                            param = item.reqid})' ">
                            <span>(@item.doc_Count) Documents</span>
                            <i class="bi bi-plus-lg d-block d-md-none"></i>
                        </button>
                    </td>
                    <td style="display:flex;">
                        @if(item.physician_id != null)
                        {                            
                            <div style="display:flex;">
                            <div class="dropdown me-3">
                                <button type="button" style="border:1px solid black!important;border-radius:5px;" class="btn border border-white p-2 navbar-toggler" onclick="ChatWith(@item.reqid,@item.physician_id,0)">
                                    <i class="fa-regular fa-user"></i>
                                    <span class="px-2 ">
                                        Provider
                                    </span>
                                </button>
                            </div>
                        </div>
                        }
                        <div style="display:flex;">
                            <div class="dropdown">
                                <button style="border:1px solid black!important;border-radius:5px;" class="btn border border-white p-2 navbar-toggler" type="button" onclick="ChatWith(@item.reqid,0,@item.admin_id)"
                                         aria-expanded="false">
                                    <i class="fa-solid fa-user-doctor me-2 d-none d-sm-inline"></i>
                                    <span>
                                        Admin
                                    </span>
                                </button>
                            </div>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div id="partialViewForChat"></div>

   @*  <div class="offcanvas offcanvas-end " tabindex="-1" id="offcanvasNavbarLight" aria-labelledby="offcanvasNavbarLightLabel" aria-modal="true" role="dialog">
        <section style="background-color: #eee;height:100%;">
            <div style="height:100%;">

                <div class="d-flex justify-content-center" style="height:100%;width:100%;">
                    <div class="col-12">

                        <div class="card" id="chat1" style="border-radius: 15px;height:100%;">
                            <div class="card-header d-flex justify-content-between align-items-center p-3 bg-info text-white border-bottom-0">
                                <i class="fas fa-angle-left"></i>
                                <p class="mb-0 fw-bold">Live chat</p>
                                <button class="fas fa-times btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                            </div>
                            <div class="card-body">
                                <div id="discussionTwo">
                                </div>

                                <div class="form-outline mb-3" style="position: fixed;width: 20%;bottom: 0;">
                                    <input type="text" style="width:89%;height:35px;" id="message" />
                                    <button style="background-color: #0d6efd;border: none;border-radius: 5px;height:35px;width:35px;" id="sendmessage" value="send">
                                        <i class="bi bi-send" style="color:white;"></i>
                                    </button>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </section>
        </div> *@

</div> 
@* @foreach(var item in Model.data)
{
    <div class="accordion accordion-flush d-block d-sm-none" id="accordionFlushExample">
        @{
            var myid = 
        }
        <div class="accordion-item" id="@myid">
            <h2 class="accordion-header" id="flush-headingOne">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#flush-collapseOne" aria-expanded="false"
                        aria-controls="flush-collapseOne">
                    Created Date:  @item.created_date.Day
                                    @item.created_date.ToString("MMM")
                                    @item.created_date.Year
                </button>
            </h2>
            <div id="flush-collapseOne" class="accordion-collapse collapse"
                 aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                <div class="accordion-body">
                   <div>
                        <i class="fa-solid fa-user me-2"></i><span>@item.phy_fname</span>
                        
                   </div>
                   <div>
                        <i class="fa-solid fa-check me-2"></i><span>@Enum[(int)item.req_type_id]</span>
                   </div>
                </div>
            </div>
        </div>
    </div>

}

 *@
<div class="accordion accordion-flush d-block d-sm-none" id="accordionFlushExample">


    @{
        var count = 0;

      @foreach (var item in Model.data)
        {
            var myidheader = "item" + count;
            var myidbody = "itembody" + count;
            count += 1;
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="@myidheader">
                                                   <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                                data-bs-target="#@myidbody" aria-expanded="false"
                                                           aria-controls="flush-collapseOne">
                                                       Created Date:  @item.created_date.Day
                                                       @item.created_date.ToString("MMM")
                                                       @item.created_date.Year
                                                   </button>
                                               </h2>
                                               <div id="@myidbody" class="accordion-collapse collapse"
                                                    aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                                                   <div class="accordion-body">
                                                       <div>
                                                           <i class="fa-solid fa-user me-2"></i><span>@item.phy_fname</span>

                                                       </div>
                                                       <div>
                                                           <i class="fa-solid fa-check me-2"></i><span>@Enum[(int)item.req_type_id]</span>
                                                       </div>
                                                   </div>
                                               </div>
                                           </div>

}
}

</div>

<link rel="stylesheet" href="/css/patientDashboard.css">

<script src="https://cdn.jsdelivr.net/npm/@@microsoft/signalr@7.0.14/dist/browser/signalr.min.js"></script>

<script>
  
    var links = document.querySelectorAll('.links');
    links.forEach(link => {
        link.addEventListener("click", function () {
            links.forEach(link => link.classList.remove('active'));
            this.classList.add('active');
        })
    })

    function redirectToDetail(value) {
        var url = '/PatientDashboard/ViewDetail?param=' + encodeURIComponent(value);
        document.location = url;
    }

    let forRequestId;
    let a = document.getElementById("firstBtn")
    let b = document.getElementById("secondBtn")
   
    function meId(id) {
        forRequestId = id;
        if (forRequestId == 0) {
            a.style.backgroundColor = "skyblue";
            b.style.backgroundColor = "white"
        } else if (forRequestId == 1) {
            b.style.backgroundColor = "skyblue"
            a.style.backgroundColor = "white"
        }
    }

    function redirectPage() {
        if (forRequestId == 0) {
            location.href = '@Url.Action("dashboardMeView","patientDashboard")';
        } else if (forRequestId == 1) {
            location.href = '@Url.Action("dashboardSomeOneView","patientDashboard")';
        }
    }   

    var REQUESTID = 0;
    var ADMINID = 0;
    var PROVIDERID = 0;
    function ChatWith(x, y, z) {
        REQUESTID = x;
        ADMINID = z;
        PROVIDERID = y;
        chatafter();
    }
    function chatafter() {
        $.ajax({ 
            method: "GET",
            url: "/Home/Chat",
            data: {
                RequestId: REQUESTID,
                AdminID: ADMINID,
                ProviderId: PROVIDERID,

            },
            success: function (data) {
                $('#partialViewForChat').html(data);
                $('#offcanvasRight').offcanvas("show");
            },
            error: function () {
                console.log("Function Fail");
            }

        });
    }

</script>
