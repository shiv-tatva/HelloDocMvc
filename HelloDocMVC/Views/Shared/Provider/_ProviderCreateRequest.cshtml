@model DAL_Data_Access_Layer_.CustomeModel.createRequest;

<style>
    .iti {
        width: 100%;
    }

    .iti__country-list {
        z-index: 3 !important;
    }
</style>


<div class="container">

    <div class=" mt-4 d-flex justify-content-between align-items-center">
        <h4>Submit Information</h4>
        <a onclick="DashboardMain()" class="btn shadow  btn-outline-info px-3 ">
            <i class="fa-solid fa-angle-left fs-6"></i> Back
        </a>
    </div>

    <form class="shadow border rounded my-3" id="CreateRequestForm" method="post">
        <div class="mx-3 my-4 ">
            <h5 class="mb-3 mt-2">Patient</h5>

            <div class="row mb-3">
                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="   firstname" type="text" class="form-control dark-mode2 bg-transparent" id="floatingInputFName"
                           placeholder="Firstname">
                    <label for="floatingInputFName" class="ms-2">First Name</label>
                    <span asp-validation-for="   firstname" class="text-danger"></span>
                </div>

                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="   lastname" type="text" class="form-control dark-mode2 bg-transparent" id="floatingInputLName"
                           placeholder="LastName">
                    <label for="floatingInputLName" class="ms-2">Last Name</label>
                    <span asp-validation-for="   lastname" class="text-danger"></span>
                </div>

                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="phone" style="height:56px" id="floatingInputPhone"
                           class="d1class form-control dark-mode2 contact bg-transparent"
                           aria-label="Contact"
                           type="number" />
                    <span asp-validation-for="phone" class="text-danger"></span>
                    @* <input asp-for="   phone" type="tel" class="form-control dark-mode2 bg-transparent" id="floatingInputPhone" placeholder="number">
                    <span asp-validation-for="   phone" class="text-danger"></span> *@
                </div>
                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="email" type="email" class="form-control dark-mode2 bg-transparent" id="floatingInputEmail"
                           placeholder="name@example.com">
                    <label for="floatingInputEmail" class="ms-2">Email</label>
                    <span asp-validation-for="email" class="text-danger"></span>
                </div>
                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="   dateofbirth" type="date" class="form-control dark-mode2 bg-transparent" id="datePickerId" placeholder="DateOfBirth">
                    <label for="datePickerId" class="ms-2">Date Of Birth</label>
                    <span asp-validation-for="dateofbirth" class="text-danger"></span>


                </div>
            </div>

            <h5 class="mb-3 mt-3">Patient Location</h5>
            <div class="row mb-3">
                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="street" type="text" class="form-control dark-mode2 bg-transparent" id="floatingInputStreet"
                           placeholder="street">
                    <label for="floatingInputStreet" class="ms-2">Street</label>
                    <span asp-validation-for="street" class="text-danger"></span>
                </div>

                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="city" type="text" class="form-control dark-mode2 bg-transparent" id="floatingInputCity" placeholder="city">
                    <label for="floatingInputCity" class="ms-2">City</label>
                    <span asp-validation-for="city" class="text-danger"></span>
                </div>

                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="state" onchange="stateOnChange()" type="text" class="form-control dark-mode2 bg-transparent" id="floatingInputState" placeholder="state">
                    <label for="floatingInputState" class="ms-2">State</label>
                    <span asp-validation-for="state" class="text-danger"></span>
                </div>

                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="zipcode" type="number" class="form-control dark-mode2 bg-transparent" id="floatingInputZipcode"
                           placeholder="zipcode">
                    <label for="floatingInputZipcode" class="ms-2">Zip Code</label>
                    <span asp-validation-for="zipcode" class="text-danger"></span>
                </div>

                <div class="col-12 col-md-6 form-floating mb-3">
                    <input asp-for="room" type="text" class="form-control dark-mode2 bg-transparent" id="floatingInputRoom" placeholder="room">
                    <label for="floatingInputRoom" class="ms-2">Room # (Optional)</label>
                </div>

                <div class="col form-floating mb-3">
                    <button type="button" onclick="verifyRequestState()" class="btn btn-outline border-info p-3 text-info me-2">
                        <span>Verify</span>
                    </button>
                    <button type="button" onclick="createReqMap()" class="btn btn-outline border-info p-3 text-info">
                        <i class="fa-solid fa-location-dot"></i>
                        <span>Map</span>
                    </button>
                </div>

            </div>
            <h5 class="mb-3 mt-2">Notes</h5>
            <div class="form-floating mb-3">
                <textarea asp-for="admin_notes" class="form-control dark-mode2 bg-transparent border border-2 h-100" rows="5"
                          placeholder="Leave a comment here" id="floatingTextareaNotes"></textarea>
                <label for="floatingTextareaNotes" class="text-wrap">Admin Notes(Optional)</label>
            </div>
            <div class="d-flex gap-2 justify-content-end mb-3">
                <button onclick="createRequestSubmitMain()" class="btn btn-info text-white" type="button">Submit</button>
                <button onclick="createRequestClearAll()" id="createRequestClear" type="button" class="btn btn-outline-info">Cancel</button>
            </div>
        </div>
    </form>

</div>

<partial name="_ValidationScriptsPartial" />

<script>



    function createRequestSubmitMain() {
        var payload = $("#CreateRequestForm").serializeArray();


        if ($("#CreateRequestForm").valid()) {
            $.ajax({
                url: "/Provider/createRequestMain",
                type: 'POST',
                data: payload,
                success: function (result) {
                    // createRequest();
                    if (result.createReq == true) {
                        document.getElementById("floatingInputState").style.border = "1px solid #dee2e6";
                        toastr.success("Request Submitted Successfully");
                        $("#createRequestClear").click();
                    } else {
                        document.getElementById("floatingInputState").style.border = "1px solid red";
                        toastr.error("Please Enter A Valid State")
                    }
                },
                error: function () {
                    alert("Error to load Partial View");
                },
            });
        }
    }

    function verifyRequestState() {

        var stateMain_ = $("#floatingInputState").val();
        console.log(stateMain_);

        $.ajax({
            url: "/Provider/verifyState",
            type: 'GET',
            data: { stateMain: stateMain_ },
            success: function (result) {
                event.preventDefault();
                if (result.isSend == true) {
                    document.getElementById("floatingInputState").style.border = "1px solid green";
                } else {
                    document.getElementById("floatingInputState").style.border = "1px solid red";
                }
            },
            error: function () {
                toastr.error("Error To Load Partial View");
            },
        });
    }

    function createRequestClearAll() {
        let a = document.getElementsByTagName("input")
        for (let i = 0; i < a.length; i++) {
            a[i].value = "";
        }

        let b = document.getElementsByTagName("textarea")
        for (let i = 0; i < b.length; i++) {
            b[i].value = "";
        }
    }

    function stateOnChange() {
        document.getElementById("floatingInputState").style.border = "1px solid #dee2e6";
    }

    function createReqMap() {
        var street = $("#floatingInputStreet").val();
        var city = $("#floatingInputCity").val();
        var state = $("#floatingInputState").val();
        var zipcode = $("#floatingInputZipcode").val();

        if (city != "" || state != "" || zipcode != "") {
            // Open the Google Maps link if all values are present
            window.open("https://www.google.com/maps/search/?api=1&query=" + street + "+" + city + "+" + state + "+" + zipcode, "_blank");
        } else {
            // Display an error message if any value is missing
            toastr.error("Please Enter Locations");
        }
    }


    const currentDateCreateRequest = new Date().toISOString().split('T')[0];

    document.getElementById('datePickerId').setAttribute('max', currentDateCreateRequest);

    var phoneInputPatientCreateRequest = document.querySelector("#floatingInputPhone");
    var phoneInputMyProfile = window.intlTelInput(phoneInputPatientCreateRequest, {
        utilsScript:
            "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
    });

</script>