@model DAL_Data_Access_Layer_.CustomeModel.adminDashData;

@{
    ViewData["Title"] = "Encounter Page";
}

<style>
    .iti {
        width: 100%;
    }

    .iti__country-list {
        z-index: 3 !important;
    }
</style>

<div class="container">
    <div class=" mt-4 d-flex justify-content-between align-items-center">
        <h4>Encounter Form</h4>
        <a onclick="DashboardMain()"
           class="btn shadow  btn-outline-secondary border-info text-info px-3 ">
            <i class="fa-solid fa-angle-left"></i> Back
        </a>
    </div>
    <form action="" class="shadow border rounded my-3" method="post">
        <input type="hidden" value="@Model._encounter.reqid" id="encounterReqId" />
        <div class="mx-3 my-4 mt-3">
            <h3 class="mb-3 text-center text-info">Medical Report-Confidential</h3>
            <div class="row">
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <input name="first_name" type="text" value="@Model._encounter.FirstName" class="form-control dark-mode2 "
                           id="exampleFormControlInput1" placeholder="Firstname" disabled>
                    <label for="exampleFormControlInput1" class="form-label ms-2">Firstname</label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <input name="last_name" type="text" value="@Model._encounter.LastName" class="form-control dark-mode2 "
                           id="exampleFormControlInput2" placeholder="Lastname" disabled>
                    <label for="exampleFormControlInput2" class="form-label ms-2">Lastname</label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-12 form-floating mb-3 text-muted">
                    <input name="Location" type="text" value="@Model._encounter.Location" class="form-control dark-mode2 "
                           id="exampleFormControlInput3" placeholder="Location" disabled>
                    <label for="exampleFormControlInput3" class="form-label ms-2">Location</label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <input value="@Model._encounter.BirthDate" type="date" asp-format="{0:yyyy-MM-dd}" name="DOB" class="form-control dark-mode2 " id="dob"
                           placeholder="Date Of Birth">
                    <label for="dob" class="form-label ms-2">Date Of Birth</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <input type="date" asp-for="@Model._encounter.Date" class="form-control dark-mode2 dclass" id="Date" placeholder="Date" disabled>
                    <label for="Date" class="form-label ms-2">Date</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <input disabled value="@Model._encounter.PhoneNumber" style="height:58px" id="phoneEncounter"
                           class=" form-control dark-mode2 contact"
                           aria-label="Contact"
                           type="number" />
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <input name="email" value="@Model._encounter.Email" type="email" class="form-control dark-mode2 " id="email"
                           placeholder="Email" disabled>
                    <label for="email" class="form-label ms-2">Email</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.HistoryIllness" value="@Model._encounter.HistoryIllness" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="encounter_hl" 
                              style="height: 100px"></textarea>
                    <label for="encounter_hl" class="ms-2">History Of present illness or Injury</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating  mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.MedicalHistory" value="@Model._encounter.MedicalHistory" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="encounter_mh" 
                              style="height: 100px"></textarea>
                    <label for="encounter_mh" class="ms-2">Medical History</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Medications" value="@Model._encounter.Medications" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="encounter_medications" 
                              style="height: 100px"></textarea>
                    <label for="encounter_medications" class="ms-2">Medications</label>
                </div>
                <div class="col-sm-12 col-md-6 col-lg-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Allergies" value="@Model._encounter.Allergies" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="encounter_al" 
                              style="height: 100px"></textarea>
                    <label for="encounter_al" class="ms-2">Allergies</label>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-4 col-6 form-floating mb-3 text-muted">
                    <input asp-for="@Model._encounter.Temp" value="@Model._encounter.Temp" type="number" class="form-control dark-mode2 dclass" id="temp"
                           placeholder="Temp" >
                    <label for="temp" class="form-label ms-2">Temp</label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-sm-6 col-md-4 col-lg-4 col-6 form-floating mb-3 text-muted">
                    <input asp-for="@Model._encounter.Hr" value="@Model._encounter.Hr" type="number" class="form-control dark-mode2 dclass" id="hr"
                           placeholder="HR" >
                    <label for="hr" class="form-label ms-2">HR</label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-sm-6 col-md-4 col-xl-4 col-6 form-floating mb-3 text-muted">
                    <input asp-for="@Model._encounter.Rr" value="@Model._encounter.Rr" type="number" class="form-control dark-mode2 dclass" id="rr"
                           placeholder="RR" >
                    <label for="rr" class="form-label ms-2">RR</label>
                    <span class="text-danger"></span>
                </div>

                <div class="col-sm-6 col-md-2 col-xl-2 col-6 form-floating mb-3 text-muted">
                    <input asp-for="@Model._encounter.BpS" value="@Model._encounter.BpS" type="number" class="form-control dark-mode2 dclass" id="bps"
                           placeholder="FirsBlood pressuretname" >
                    <label for="bps" class="form-label ms-2">
                        Blood pressure
                        (Systolic)
                    </label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-sm-6 col-md-2 col-xl-2 col-6 form-floating mb-3 text-muted">
                    <input asp-for="@Model._encounter.BpD" value="@Model._encounter.BpD" type="number" class="form-control dark-mode2 dclass" id="bpd"
                           placeholder="Blood pressure" >
                    <label for="bpd" class="form-label ms-2">
                        Blood pressure
                        (Diastolic)
                    </label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-sm-6 col-md-4 col-xl-4 col-6 form-floating mb-3 text-muted">
                    <input asp-for="@Model._encounter.O2" value="@Model._encounter.O2" type="number" class="form-control dark-mode2 dclass" id="o2"
                           placeholder="O2" >
                    <label for="o2" class="form-label ms-2">O2</label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-sm-6 col-md-4 col-xl-4 col-6 form-floating mb-3 text-muted">
                    <input asp-for="@Model._encounter.Pain" value="@Model._encounter.Pain" type="text" class="form-control dark-mode2 dclass" id="pain"
                           placeholder="Pain" >
                    <label for="pain" class="form-label ms-2">Pain</label>
                    <span class="text-danger"></span>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6  form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Heent" value="@Model._encounter.Heent" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="heent" 
                              style="height: 100px"></textarea>
                    <label for="heent" class="ms-2">Heent</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Cv" value="@Model._encounter.Cv" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="cv" 
                              style="height: 100px"></textarea>
                    <label for="cv" class="ms-2">CV</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Chest" value="@Model._encounter.Chest" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="chest" 
                              style="height: 100px"></textarea>
                    <label for="chest" class="ms-2">Chest</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Abd" value="@Model._encounter.Abd" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="abd" 
                              style="height: 100px"></textarea>
                    <label for="abd" class="ms-2">ABD</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Extr" value="@Model._encounter.Extr" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="extr" 
                              style="height: 100px"></textarea>
                    <label for="extr" class="ms-2">Extr</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating  mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Skin" value="@Model._encounter.Skin" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="skin" 
                              style="height: 100px"></textarea>
                    <label for="skin" class="ms-2">Skin</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Neuro" value="@Model._encounter.Neuro" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="neuro" 
                              style="height: 100px"></textarea>
                    <label for="neuro" class="ms-2">Neuro</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Other" value="@Model._encounter.Other" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="other" 
                              style="height: 100px"></textarea>
                    <label for="other" class="ms-2">Other</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Diagnosis" value="@Model._encounter.Diagnosis" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="daignosis" 
                              style="height: 100px"></textarea>
                    <label for="daignosis" class="ms-2">Diagnosis</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating  mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.TreatmentPlan" value="@Model._encounter.TreatmentPlan" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="treatmentplan" 
                              style="height: 100px"></textarea>
                    <label for="treatmentplan" class="ms-2">Treatment Plan</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.MedicationDispensed" value="@Model._encounter.MedicationDispensed" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="encounter_md" 
                              style="height: 100px"></textarea>
                    <label for="encounter_md" class="ms-2">Medications Dispensed</label>
                </div>
                <div class="col-sm-12 col-md-6 col-xl-6 form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.Procedures" value="@Model._encounter.Procedures" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="procedures" 
                              style="height: 100px"></textarea>
                    <label for="procedures" class="ms-2">Procedures</label>
                </div>
                <div class="form-floating mb-3 text-muted">
                    <textarea asp-for="@Model._encounter.FollowUp" value="@Model._encounter.FollowUp" class="form-control dark-mode2 dclass" placeholder="Leave a comment here" id="followup" 
                              style="height: 100px"></textarea>
                    <label for="followup" class="ms-2">Followup</label>
                </div>
            </div>
            <div class="d-grid gap-2 d-flex justify-content-center  justify-content-md-end mt-4 pt-4 mb-3">

                <button type="button" onclick="encounterBtn()" id="submitBtn" class="btn btn-info text-white EditBtn">Save Changes</button>

                <button type="button" onclick="FinalizeBtn(@Model._encounter.reqid)" id="submitBtn" class="btn text-white EditBtn" style="background-color:purple;">Finalize</button>

                <button type="button" id="cancelEncounterBtn" class="btn btn-outline-info EditBtn" onclick="disableFields()">Cancel</button>

            </div>
        </div>
    </form>
</div>

<script>

    function encounterBtn() {
        var payload = {
            reqid: $("#encounterReqId").val(),
            Date: $("#Date").val(),
            HistoryIllness: $("#encounter_hl").val(),
            MedicalHistory: $("#encounter_mh").val(),
            Medications: $("#encounter_medications").val(),
            Allergies: $("#encounter_al").val(),
            Temp: $("#temp").val(),
            Hr: $("#hr").val(),
            Rr: $("#rr").val(),
            BpS: $("#bps").val(),
            BpD: $("#bpd").val(),
            O2: $("#o2").val(),
            Pain: $("#pain").val(),
            Heent: $("#heent").val(),
            Cv: $("#cv").val(),
            Chest: $("#chest").val(),
            Abd: $("#abd").val(),
            Extr: $("#extr").val(),
            Skin: $("#skin").val(),
            Neuro: $("#neuro").val(),
            Other: $("#other").val(),
            Diagnosis: $("#daignosis").val(),
            TreatmentPlan: $("#treatmentplan").val(),
            MedicationDispensed: $("#encounter_md").val(),
            Procedures: $("#procedures").val(),
            FollowUp: $("#followup").val(),
        };

        $.ajax({
            url: "/Provider/concludeEncounter",
            type: 'POST',
            data: payload,
            success: function (result) {
                if (result.isSend == true) {
                    toastr.success("Encounter Form Update Successfully");
                    ProviderEncounterForm(result.data);
                } else {
                    toastr.error("Change atleast one field");
                    ProviderEncounterForm(result.data);
                }
            },
            error: function () {
                alert("Error");
            },
        });
    }

    var phoneInputPatientEncounter = document.querySelector("#phoneEncounter");
    var phoneInputEncounter = window.intlTelInput(phoneInputPatientEncounter, {
        utilsScript:
            "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
    });

    // function disableFields() {
    //     document.querySelectorAll('.dclass').forEach(function (element) {
    //         element.disabled = true;
    //     });
    //     document.getElementById('submitBtn').style.display = 'none';
    //     document.getElementById('cancelEncounterBtn').style.display = 'none';
    //     document.getElementById('editBtn').style.display = 'block';
    // }

    // function enableFields() {
    //     document.querySelectorAll('.dclass').forEach(function (element) {
    //         element.disabled = false;
    //     });
    //     document.getElementById('submitBtn').style.display = 'block';
    //     document.getElementById('cancelEncounterBtn').style.display = 'block';
    //     document.getElementById('editBtn').style.display = 'none';
    // }
    // enableFields();

    function encounterBtnSub() {
        var payload = {
            reqid: $("#encounterReqId").val(),
            Date: $("#Date").val(),
            HistoryIllness: $("#encounter_hl").val(),
            MedicalHistory: $("#encounter_mh").val(),
            Medications: $("#encounter_medications").val(),
            Allergies: $("#encounter_al").val(),
            Temp: $("#temp").val(),
            Hr: $("#hr").val(),
            Rr: $("#rr").val(),
            BpS: $("#bps").val(),
            BpD: $("#bpd").val(),
            O2: $("#o2").val(),
            Pain: $("#pain").val(),
            Heent: $("#heent").val(),
            Cv: $("#cv").val(),
            Chest: $("#chest").val(),
            Abd: $("#abd").val(),
            Extr: $("#extr").val(),
            Skin: $("#skin").val(),
            Neuro: $("#neuro").val(),
            Other: $("#other").val(),
            Diagnosis: $("#daignosis").val(),
            TreatmentPlan: $("#treatmentplan").val(),
            MedicationDispensed: $("#encounter_md").val(),
            Procedures: $("#procedures").val(),
            FollowUp: $("#followup").val(),
        };

        $.ajax({
            url: "/Provider/concludeEncounter",
            type: 'POST',
            data: payload,
            success: function (result) {
                if (result.isSend == true) {                    
                    console.log("done")
                } else {
                    console.log("error")
                }
            },
            error: function () {
                alert("Error");
            },
        });
    }
   
    
    function FinalizeBtn(reqId) {
        encounterBtnSub();

        let action = "/Provider/FinalizeEncounter";
        setTimeout(() => {
        $.ajax({
            url: action,
            type: 'GET',
            data: { reqId: reqId },
            success: function (result) {
               DashboardMain();
               toastr.success("Encounter Form Update Successfully");                   
            },
            error: function () {
                toastr.error("Error");
            },
        });
        }, 1000);
    }

   

    const currentDateEncounter = new Date().toISOString().split('T')[0];

    document.getElementById('Date').setAttribute('max', currentDateEncounter);

</script>



